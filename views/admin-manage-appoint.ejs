<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Appointments | MediConnect</title>

  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background: url("/images/background.jpeg") no-repeat center center/cover;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 250px;
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      display: flex; flex-direction: column; align-items: center;
      padding: 25px 0;
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .sidebar h2 { margin-bottom: 40px; }
    .sidebar ul { list-style: none; width: 100%; }
    .sidebar ul li a {
      display: block; padding: 14px 25px; color: white; text-decoration: none;
      transition: 0.3s; border-left: 4px solid transparent;
    }
    .sidebar ul li a:hover,
    .sidebar ul li.active a {
      background: rgba(255,255,255,0.15);
      border-left: 4px solid white;
      font-weight: 600;
    }

    /* ===== MAIN CONTENT ===== */
    .main-content { flex: 1; padding: 30px; color: #333; }
    header {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 25px;
    }
    header h1 { color: #0056b3; }

    .btn-primary {
      background: linear-gradient(135deg, #007bff, #0056b3);
      border: none; padding: 10px 18px; border-radius: 8px;
      color: white; cursor: pointer; transition: 0.3s;
    }
    .btn-primary:hover { transform: scale(1.05); }

    /* ===== TABLE ===== */
    .styled-table {
      width: 100%; border-collapse: collapse; margin-top: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      border-radius: 10px; overflow: hidden;
    }
    .styled-table thead { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
    .styled-table th, .styled-table td { padding: 14px 16px; }
    .styled-table tbody tr { background: white; border-bottom: 1px solid #ddd; }
    .styled-table tbody tr:hover { background: #f1f5ff; }

    .btn-edit, .btn-delete {
      padding: 6px 12px; border: none; border-radius: 6px;
      cursor: pointer; font-size: 14px;
    }
    .btn-edit { background: #00b894; color: white; }
    .btn-edit:hover { background: #019874; }
    .btn-delete { background: #e74c3c; color: white; }
    .btn-delete:hover { background: #c0392b; }

    /* ===== POPUP SMALL PAGE FORM ===== */
    .overlay {
      display: none; /* hidden by default */
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      justify-content: center; align-items: center;
      z-index: 999;
    }

    .popup-form {
      background: #fff;
      width: 380px;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .popup-form h3 {
      text-align: center;
      color: #0056b3;
      margin-bottom: 20px;
    }

    .popup-form label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
      color: #333;
    }

    .popup-form input, .popup-form select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 6px;
    }

    .popup-form .actions {
      margin-top: 20px;
      text-align: center;
    }

    .popup-form .actions button {
      padding: 8px 16px;
      margin: 0 6px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      color: white;
    }

    .save-btn { background: #00b894; }
    .cancel-btn { background: #e74c3c; }
  </style>
</head>

<body>
  <div class="sidebar">
    <h2>ðŸ©º MediConnect</h2>
    <ul>
      <li><a href="/user/admin">Dashboard</a></li>
      <li><a href="/user/admin-doctor">Doctors</a></li>
      <li class="active"><a href="/user/admin-manage-api">Appointments</a></li>
      <li><a href="/user/admin-login">Logout</a></li>
    </ul>
  </div>

  <div class="main-content">
    <header>
      <h1>Manage Appointments</h1>
      <button class="btn-primary"><a href="/user/book-by-admin" style="color:white;text-decoration:none;">+ New Appointment</a></button>
    </header>

    <table class="styled-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Patient Name</th>
          <th>Doctor</th>
          <th>Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <% if(appointments && appointments.length>0){ %>
      <tbody>
        <% appointments.forEach(appi => { %>
        <tr>
          <td><%= appi.id %></td>
          <td><%= appi.patient_name %></td>
          <td><%= appi.doctor %></td>
          <td><%= new Date(appi.date).toISOString().split("T")[0] %></td>
          <td><%= appi.status %></td>
          <td>
            <button class="btn-edit" onclick="showPopup('<%= appi.id %>', '<%= appi.patient_name %>', '<%= appi.doctor %>', '<%= appi.date %>', '<%= appi.status %>')">Edit</button>
            <form action="/user/delete-patient" method="post"  style="display:inline;">
              <input type="hidden" value="<%=appi.id%>" name="id">
              <button type="submit" class="btn-delete">Cancel</button>
            </form>
          </td>
        </tr>
        <% }) %>
      </tbody>
      <% } else { %>
      <tr><td colspan="6">No appointments found</td></tr>
      <% } %>
    </table>
  </div>

  <!-- ====== POPUP SMALL FORM ====== -->
  <div class="overlay" id="editOverlay">
    <div class="popup-form">
      <h3>Edit Appointment</h3>
      <form id="editForm" action="/user/edit-appi" method="post">
        <input type="hidden" id="editId" name="editId">
        <label>Patient Name:</label>
        <input type="text" id="editPatient" name="editPatient" readonly>

        <label>Doctor:</label>
        <input type="text" id="editDoctor" name="editDoctor" readonly>

        <label>Date:</label>
        <input type="date" id="editDate" name="editDate">

        <label>Status:</label>
        <select id="editStatus" name="editStatus">
          <option value="Pending">Pending</option>
          <option value="Confirmed">Confirmed</option>
          <option value="Completed">Completed</option>
          <option value="Cancelled">Cancelled</option>
        </select>

        <div class="actions">
          <button type="submit" class="save-btn" onclick="saveChanges()">Save</button>
          <button type="button" class="cancel-btn" onclick="closePopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const overlay = document.getElementById('editOverlay');

    function showPopup(id, patient, doctor, date, status) {
      overlay.style.display = 'flex';
      document.getElementById('editId').value = id;
      document.getElementById('editPatient').value = patient;
      document.getElementById('editDoctor').value = doctor;
      document.getElementById('editDate').value = new Date(date).toISOString().split("T")[0];
      document.getElementById('editStatus').value = status;
    }

    function closePopup() {
      overlay.style.display = 'none';
    }

    window.onclick = (e) => {
      if (e.target === overlay) closePopup();
    }
  </script>
</body>
</html>
